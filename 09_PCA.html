<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>pca</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="09_PCA_files/libs/clipboard/clipboard.min.js"></script>
<script src="09_PCA_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="09_PCA_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="09_PCA_files/libs/quarto-html/popper.min.js"></script>
<script src="09_PCA_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="09_PCA_files/libs/quarto-html/anchor.min.js"></script>
<link href="09_PCA_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="09_PCA_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="09_PCA_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="09_PCA_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="09_PCA_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="introducción" class="level1">
<h1>Introducción</h1>
<p>Este documento realiza un Análisis de Componentes Principales (PCA) sobre la unión de los archivos <code>anthropometrics.csv</code> y <code>vital_signs.csv</code> (solo <code>visit == 3</code>), tal como solicitaste. Se incluye:</p>
<ol type="1">
<li>Matriz de correlaciones.</li>
<li>Estandarización de las variables (explicación y efecto).</li>
<li>Cálculo del PCA y extracción de los valores propios (autovalores/eigenvalues).</li>
<li>Gráfico de sedimentación (scree plot).</li>
<li>Círculo de correlaciones (variables en el plano de las dos primeras componentes).</li>
<li>Biplot (individuos y variables).</li>
<li>Gráficos de correlación entre cada variable y los componentes principales.</li>
</ol>
<p>Al final se muestran las tablas con los autovalores y la proporción de varianza explicada.</p>
<blockquote class="blockquote">
<p><strong>Nota:</strong> ajusta las rutas de los archivos si tu proyecto usa otra ubicación. El código aquí asume que los CSV están en <code>C:/Users/UIB/Downloads/AI4FoodDB/...</code> como en tu ejemplo.</p>
</blockquote>
<section id="carga-de-datos-y-creación-del-objeto-total" class="level2">
<h2 class="anchored" data-anchor-id="carga-de-datos-y-creación-del-objeto-total">0. Carga de datos y creación del objeto <code>Total</code></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>anthropometrics <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/UIB/Downloads/AI4FoodDB/DS1_AnthropometricMeasurements/anthropometrics.csv"</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>vital_signs <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"C:/Users/UIB/Downloads/AI4FoodDB/DS6_VitalSigns/vital_signs.csv"</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>Total <span class="ot">&lt;-</span> anthropometrics <span class="sc">%&gt;%</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(vital_signs, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"id"</span>, <span class="st">"visit"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(visit <span class="sc">==</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">na.omit</span>()</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Conservamos id por separado y preparamos la matriz para PCA</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>ids <span class="ot">&lt;-</span> Total<span class="sc">$</span>id</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>Total_pca <span class="ot">&lt;-</span> Total <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>id, <span class="sc">-</span>visit, <span class="sc">-</span>period)  <span class="co"># quitar identificadores</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Comprobar dimensiones</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dimensiones (filas, columnas):"</span>, <span class="fu">dim</span>(Total_pca)[<span class="dv">1</span>], <span class="st">","</span>, <span class="fu">dim</span>(Total_pca)[<span class="dv">2</span>], <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dimensiones (filas, columnas): 92 , 11 </code></pre>
</div>
</div>
</section>
</section>
<section id="matriz-de-correlaciones" class="level1">
<h1>1. Matriz de correlaciones</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Matriz de correlación (usar solo variables numéricas)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>num_vars <span class="ot">&lt;-</span> Total_pca <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>cor_mat <span class="ot">&lt;-</span> <span class="fu">cor</span>(num_vars)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Mostrar la matriz (tabla reducida si es grande)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">round</span>(cor_mat, <span class="dv">3</span>), <span class="at">caption =</span> <span class="st">"Matriz de correlaciones (solo numéricas)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Matriz de correlaciones (solo numéricas)</caption>
<colgroup>
<col style="width: 13%">
<col style="width: 8%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 4%">
<col style="width: 3%">
<col style="width: 13%">
<col style="width: 13%">
<col style="width: 6%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">current_weight_kg</th>
<th style="text-align: right;">bmi_kg_m2</th>
<th style="text-align: right;">fat_mass_perc</th>
<th style="text-align: right;">muscle_mass_perc</th>
<th style="text-align: right;">visceral_fat_level</th>
<th style="text-align: right;">basal_metabolism</th>
<th style="text-align: right;">waist_cm</th>
<th style="text-align: right;">hip_cm</th>
<th style="text-align: right;">systolic_blood_pressure_mmhg</th>
<th style="text-align: right;">dyastolic_blood_pressure_mmhg</th>
<th style="text-align: right;">heart_rate_bpm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">current_weight_kg</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.682</td>
<td style="text-align: right;">-0.177</td>
<td style="text-align: right;">0.271</td>
<td style="text-align: right;">0.702</td>
<td style="text-align: right;">0.932</td>
<td style="text-align: right;">0.749</td>
<td style="text-align: right;">0.537</td>
<td style="text-align: right;">0.416</td>
<td style="text-align: right;">0.249</td>
<td style="text-align: right;">-0.139</td>
</tr>
<tr class="even">
<td style="text-align: left;">bmi_kg_m2</td>
<td style="text-align: right;">0.682</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.426</td>
<td style="text-align: right;">-0.231</td>
<td style="text-align: right;">0.653</td>
<td style="text-align: right;">0.442</td>
<td style="text-align: right;">0.694</td>
<td style="text-align: right;">0.722</td>
<td style="text-align: right;">0.335</td>
<td style="text-align: right;">0.305</td>
<td style="text-align: right;">0.027</td>
</tr>
<tr class="odd">
<td style="text-align: left;">fat_mass_perc</td>
<td style="text-align: right;">-0.177</td>
<td style="text-align: right;">0.426</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">-0.779</td>
<td style="text-align: right;">-0.095</td>
<td style="text-align: right;">-0.474</td>
<td style="text-align: right;">0.030</td>
<td style="text-align: right;">0.492</td>
<td style="text-align: right;">-0.116</td>
<td style="text-align: right;">0.081</td>
<td style="text-align: right;">0.288</td>
</tr>
<tr class="even">
<td style="text-align: left;">muscle_mass_perc</td>
<td style="text-align: right;">0.271</td>
<td style="text-align: right;">-0.231</td>
<td style="text-align: right;">-0.779</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.122</td>
<td style="text-align: right;">0.497</td>
<td style="text-align: right;">0.025</td>
<td style="text-align: right;">-0.353</td>
<td style="text-align: right;">0.152</td>
<td style="text-align: right;">-0.148</td>
<td style="text-align: right;">-0.226</td>
</tr>
<tr class="odd">
<td style="text-align: left;">visceral_fat_level</td>
<td style="text-align: right;">0.702</td>
<td style="text-align: right;">0.653</td>
<td style="text-align: right;">-0.095</td>
<td style="text-align: right;">0.122</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.681</td>
<td style="text-align: right;">0.788</td>
<td style="text-align: right;">0.374</td>
<td style="text-align: right;">0.535</td>
<td style="text-align: right;">0.283</td>
<td style="text-align: right;">-0.163</td>
</tr>
<tr class="even">
<td style="text-align: left;">basal_metabolism</td>
<td style="text-align: right;">0.932</td>
<td style="text-align: right;">0.442</td>
<td style="text-align: right;">-0.474</td>
<td style="text-align: right;">0.497</td>
<td style="text-align: right;">0.681</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.650</td>
<td style="text-align: right;">0.293</td>
<td style="text-align: right;">0.427</td>
<td style="text-align: right;">0.148</td>
<td style="text-align: right;">-0.207</td>
</tr>
<tr class="odd">
<td style="text-align: left;">waist_cm</td>
<td style="text-align: right;">0.749</td>
<td style="text-align: right;">0.694</td>
<td style="text-align: right;">0.030</td>
<td style="text-align: right;">0.025</td>
<td style="text-align: right;">0.788</td>
<td style="text-align: right;">0.650</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.437</td>
<td style="text-align: right;">0.500</td>
<td style="text-align: right;">0.334</td>
<td style="text-align: right;">-0.094</td>
</tr>
<tr class="even">
<td style="text-align: left;">hip_cm</td>
<td style="text-align: right;">0.537</td>
<td style="text-align: right;">0.722</td>
<td style="text-align: right;">0.492</td>
<td style="text-align: right;">-0.353</td>
<td style="text-align: right;">0.374</td>
<td style="text-align: right;">0.293</td>
<td style="text-align: right;">0.437</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.145</td>
<td style="text-align: right;">0.173</td>
<td style="text-align: right;">0.001</td>
</tr>
<tr class="odd">
<td style="text-align: left;">systolic_blood_pressure_mmhg</td>
<td style="text-align: right;">0.416</td>
<td style="text-align: right;">0.335</td>
<td style="text-align: right;">-0.116</td>
<td style="text-align: right;">0.152</td>
<td style="text-align: right;">0.535</td>
<td style="text-align: right;">0.427</td>
<td style="text-align: right;">0.500</td>
<td style="text-align: right;">0.145</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.540</td>
<td style="text-align: right;">-0.066</td>
</tr>
<tr class="even">
<td style="text-align: left;">dyastolic_blood_pressure_mmhg</td>
<td style="text-align: right;">0.249</td>
<td style="text-align: right;">0.305</td>
<td style="text-align: right;">0.081</td>
<td style="text-align: right;">-0.148</td>
<td style="text-align: right;">0.283</td>
<td style="text-align: right;">0.148</td>
<td style="text-align: right;">0.334</td>
<td style="text-align: right;">0.173</td>
<td style="text-align: right;">0.540</td>
<td style="text-align: right;">1.000</td>
<td style="text-align: right;">0.121</td>
</tr>
<tr class="odd">
<td style="text-align: left;">heart_rate_bpm</td>
<td style="text-align: right;">-0.139</td>
<td style="text-align: right;">0.027</td>
<td style="text-align: right;">0.288</td>
<td style="text-align: right;">-0.226</td>
<td style="text-align: right;">-0.163</td>
<td style="text-align: right;">-0.207</td>
<td style="text-align: right;">-0.094</td>
<td style="text-align: right;">0.001</td>
<td style="text-align: right;">-0.066</td>
<td style="text-align: right;">0.121</td>
<td style="text-align: right;">1.000</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gráfico de corrplot</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>corrplot<span class="sc">::</span><span class="fu">corrplot</span>(cor_mat, <span class="at">method =</span> <span class="st">"color"</span>, <span class="at">type =</span> <span class="st">"upper"</span>, <span class="at">tl.cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_PCA_files/figure-html/correlacion-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Explicación rápida:</strong> la matriz de correlación muestra la relación lineal entre pares de variables (–1 a 1). En PCA esto ayuda a ver redundancias y variables fuertemente correlacionadas que influyen en las componentes.</p>
</section>
<section id="estandarización-de-los-datos" class="level1">
<h1>2. Estandarización de los datos</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># En PCA se suele estandarizar (media 0, sd 1) cuando las variables están en distintas escalas</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>scaled_data <span class="ot">&lt;-</span> <span class="fu">scale</span>(num_vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Qué hace la estandarización y por qué:</strong></p>
<p>Estandarizar (restar la media y dividir por la desviación estándar) sitúa todas las variables en la misma escala. Si no se estandariza, variables con unidades grandes (ej. peso en gramos) dominarán las componentes principales simplemente por su escala. Con <code>scale()</code> cada variable contribuye según su correlación, no según su magnitud.</p>
</section>
<section id="pca-y-extracción-de-valores-propios" class="level1">
<h1>3. PCA y extracción de valores propios</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usaremos prcomp con centered = TRUE y scale. = FALSE porque ya estandarizamos</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>pca_res <span class="ot">&lt;-</span> <span class="fu">prcomp</span>(scaled_data, <span class="at">center =</span> <span class="cn">TRUE</span>, <span class="at">scale. =</span> <span class="cn">FALSE</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Autovalores: para prcomp, las sdev^2 son los eigenvalues</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>eigenvalues <span class="ot">&lt;-</span> (pca_res<span class="sc">$</span>sdev)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>var_explained <span class="ot">&lt;-</span> eigenvalues <span class="sc">/</span> <span class="fu">sum</span>(eigenvalues)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>eigen_table <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">PC =</span> <span class="fu">paste0</span>(<span class="st">"PC"</span>, <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(eigenvalues)),</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Eigenvalue =</span> <span class="fu">round</span>(eigenvalues, <span class="dv">4</span>),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>                      <span class="at">Variance =</span> <span class="fu">round</span>(var_explained, <span class="dv">4</span>),</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>                      <span class="st">`</span><span class="at">Cumulative variance</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">round</span>(<span class="fu">cumsum</span>(var_explained), <span class="dv">4</span>))</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(eigen_table, <span class="at">caption =</span> <span class="st">"Valores propios (autovalues) y varianza explicada"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Valores propios (autovalues) y varianza explicada</caption>
<thead>
<tr class="header">
<th style="text-align: left;">PC</th>
<th style="text-align: right;">Eigenvalue</th>
<th style="text-align: right;">Variance</th>
<th style="text-align: right;">Cumulative variance</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PC1</td>
<td style="text-align: right;">4.6175</td>
<td style="text-align: right;">0.4198</td>
<td style="text-align: right;">0.4198</td>
</tr>
<tr class="even">
<td style="text-align: left;">PC2</td>
<td style="text-align: right;">2.6415</td>
<td style="text-align: right;">0.2401</td>
<td style="text-align: right;">0.6599</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PC3</td>
<td style="text-align: right;">1.2381</td>
<td style="text-align: right;">0.1126</td>
<td style="text-align: right;">0.7725</td>
</tr>
<tr class="even">
<td style="text-align: left;">PC4</td>
<td style="text-align: right;">0.8604</td>
<td style="text-align: right;">0.0782</td>
<td style="text-align: right;">0.8507</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PC5</td>
<td style="text-align: right;">0.5131</td>
<td style="text-align: right;">0.0466</td>
<td style="text-align: right;">0.8973</td>
</tr>
<tr class="even">
<td style="text-align: left;">PC6</td>
<td style="text-align: right;">0.3885</td>
<td style="text-align: right;">0.0353</td>
<td style="text-align: right;">0.9326</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PC7</td>
<td style="text-align: right;">0.2564</td>
<td style="text-align: right;">0.0233</td>
<td style="text-align: right;">0.9560</td>
</tr>
<tr class="even">
<td style="text-align: left;">PC8</td>
<td style="text-align: right;">0.2143</td>
<td style="text-align: right;">0.0195</td>
<td style="text-align: right;">0.9754</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PC9</td>
<td style="text-align: right;">0.1673</td>
<td style="text-align: right;">0.0152</td>
<td style="text-align: right;">0.9906</td>
</tr>
<tr class="even">
<td style="text-align: left;">PC10</td>
<td style="text-align: right;">0.0933</td>
<td style="text-align: right;">0.0085</td>
<td style="text-align: right;">0.9991</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PC11</td>
<td style="text-align: right;">0.0096</td>
<td style="text-align: right;">0.0009</td>
<td style="text-align: right;">1.0000</td>
</tr>
</tbody>
</table>
</div>
</div>
<blockquote class="blockquote">
<p>Los valores propios (<code>Eigenvalue</code>) indican la varianza capturada por cada componente. Una regla práctica (Kaiser) sugiere conservar componentes con autovalor &gt; 1 cuando se hace PCA sobre la matriz de correlación.</p>
</blockquote>
</section>
<section id="gráfico-de-sedimentación-scree-plot" class="level1">
<h1>4. Gráfico de sedimentación (Scree plot)</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_screeplot</span>(pca_res, <span class="at">addlabels =</span> <span class="cn">TRUE</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">50</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_PCA_files/figure-html/scree-plot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Interpretación:</strong> El gráfico muestra la varianza (en %) explicada por cada componente. Busca el “codo” o usa la varianza acumulada para decidir cuántas componentes retener.</p>
</section>
<section id="círculo-de-correlaciones-variables" class="level1">
<h1>5. Círculo de correlaciones (variables)</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Usando factoextra para el círculo de correlaciones</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_var</span>(pca_res,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">col.var =</span> <span class="st">"contrib"</span>, <span class="co"># color por contribución</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">gradient.cols =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"yellow"</span>, <span class="st">"red"</span>),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">repel =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">labelsize =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_PCA_files/figure-html/correlation-circle-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Qué muestra:</strong> cada vector representa la correlación entre la variable original y las componentes. Vectores largos y cerca del perímetro tienen alta correlación con las componentes; vectores cercanos al eje X o Y están correlacionados principalmente con la PC1 o PC2.</p>
</section>
<section id="biplot-de-variables-y-individuos" class="level1">
<h1>6. Biplot de variables y individuos</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Biplot con factoextra</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">fviz_pca_biplot</span>(pca_res, <span class="at">repel =</span> <span class="cn">TRUE</span>, <span class="at">label =</span> <span class="st">"var"</span>, <span class="at">addEllipses =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_PCA_files/figure-html/biplot-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Si quieres ver individuos etiquetados por id</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ind_coords <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(pca_res<span class="sc">$</span>x) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id =</span> ids)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">head</span>(ind_coords), <span class="at">caption =</span> <span class="st">"Coordenadas de los primeros individuos en el espacio de PC"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Coordenadas de los primeros individuos en el espacio de PC</caption>
<colgroup>
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 7%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">PC1</th>
<th style="text-align: right;">PC2</th>
<th style="text-align: right;">PC3</th>
<th style="text-align: right;">PC4</th>
<th style="text-align: right;">PC5</th>
<th style="text-align: right;">PC6</th>
<th style="text-align: right;">PC7</th>
<th style="text-align: right;">PC8</th>
<th style="text-align: right;">PC9</th>
<th style="text-align: right;">PC10</th>
<th style="text-align: right;">PC11</th>
<th style="text-align: left;">id</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">-1.5401359</td>
<td style="text-align: right;">-1.9131536</td>
<td style="text-align: right;">-0.0344751</td>
<td style="text-align: right;">0.1928440</td>
<td style="text-align: right;">0.1762209</td>
<td style="text-align: right;">0.4407151</td>
<td style="text-align: right;">0.4673128</td>
<td style="text-align: right;">-0.1282716</td>
<td style="text-align: right;">-0.2597347</td>
<td style="text-align: right;">0.0769033</td>
<td style="text-align: right;">-0.0963708</td>
<td style="text-align: left;">A4F_10021</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.2509518</td>
<td style="text-align: right;">-0.2057822</td>
<td style="text-align: right;">-0.9151979</td>
<td style="text-align: right;">0.2166586</td>
<td style="text-align: right;">-0.3115131</td>
<td style="text-align: right;">0.3785732</td>
<td style="text-align: right;">-0.8326386</td>
<td style="text-align: right;">-0.0830880</td>
<td style="text-align: right;">0.4746012</td>
<td style="text-align: right;">-0.1547623</td>
<td style="text-align: right;">-0.1198479</td>
<td style="text-align: left;">A4F_10141</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1.9722411</td>
<td style="text-align: right;">0.3200554</td>
<td style="text-align: right;">2.8509748</td>
<td style="text-align: right;">0.3617572</td>
<td style="text-align: right;">-0.9454229</td>
<td style="text-align: right;">0.3223597</td>
<td style="text-align: right;">0.4048971</td>
<td style="text-align: right;">-0.2190433</td>
<td style="text-align: right;">-0.4905496</td>
<td style="text-align: right;">-0.0574429</td>
<td style="text-align: right;">-0.0353668</td>
<td style="text-align: left;">A4F_10355</td>
</tr>
<tr class="even">
<td style="text-align: right;">-0.0312034</td>
<td style="text-align: right;">-3.6068621</td>
<td style="text-align: right;">-0.2228999</td>
<td style="text-align: right;">0.0622806</td>
<td style="text-align: right;">1.4382317</td>
<td style="text-align: right;">0.1154289</td>
<td style="text-align: right;">-0.3118100</td>
<td style="text-align: right;">0.5411452</td>
<td style="text-align: right;">0.3253870</td>
<td style="text-align: right;">-0.3754036</td>
<td style="text-align: right;">0.0318862</td>
<td style="text-align: left;">A4F_10660</td>
</tr>
<tr class="odd">
<td style="text-align: right;">-2.1811906</td>
<td style="text-align: right;">-2.1808570</td>
<td style="text-align: right;">-0.5420183</td>
<td style="text-align: right;">0.7819907</td>
<td style="text-align: right;">-1.1832932</td>
<td style="text-align: right;">1.2032446</td>
<td style="text-align: right;">-0.1709386</td>
<td style="text-align: right;">0.2185507</td>
<td style="text-align: right;">-0.5299048</td>
<td style="text-align: right;">0.0519529</td>
<td style="text-align: right;">-0.2068859</td>
<td style="text-align: left;">A4F_10709</td>
</tr>
<tr class="even">
<td style="text-align: right;">-2.1365103</td>
<td style="text-align: right;">0.0618556</td>
<td style="text-align: right;">-0.2218383</td>
<td style="text-align: right;">-0.5944327</td>
<td style="text-align: right;">1.2803436</td>
<td style="text-align: right;">0.1415652</td>
<td style="text-align: right;">-0.6171622</td>
<td style="text-align: right;">-0.9103554</td>
<td style="text-align: right;">-0.3581852</td>
<td style="text-align: right;">-0.2886566</td>
<td style="text-align: right;">-0.1312384</td>
<td style="text-align: left;">A4F_13368</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="correlación-entre-variables-y-componentes-principales" class="level1">
<h1>7. Correlación entre variables y componentes principales</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>var <span class="ot">&lt;-</span> <span class="fu">get_pca_var</span>(pca_res)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">corrplot</span>(var<span class="sc">$</span>cos2[,<span class="dv">1</span><span class="sc">:</span><span class="dv">11</span>], <span class="at">is.corr=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="09_PCA_files/figure-html/var-pc-correlations-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>